{% load securitytags %}
{% load hooks %}

<div class="reveal small" id="files_for_typesetting" data-reveal data-animation-in="slide-in-up"
     data-animation-out="slide-out-down">
    <div class="card">
        <div class="card-divider">
            <h4><i class="fa fa-file-word-o">&nbsp;</i>Files for Typesetting</h4>
        </div>
        <div class="card-section">
           <p>
            <small>Listed below are all the manuscript and copyedited files for this paper. Typesetters will also get access to all figure files uploaded by the author. If you need to manage these files use the <a targer="_blank" href="{% url 'document_management' article.pk %}">Document Management</a> page. If you need to upload a newer version use the Upload File button in the top right of this box.</small>
        </p>
        <table class="scroll small">
            <tr style="text-align: left">
                <th>ID</th>
                <th>Label</th>
                <th width="25%">Filename</th>
                <th>Type</th>
                <th>Modified</th>
                <th>Download</th>
                <th>Make galley</th>
            </tr>
            {% for key, list in manuscript_files.items %}
                {% for file in list %}
                {% can_view_file file as can_view_file_flag %}
                {% can_edit_file file article as can_edit_file_flag %}
                {% can_view_file_history file article as can_view_file_history_flag %}
                <tr>
                    <td>{{ file.pk }}</td>
                    <td>{{ file.label }}</td>
                    <td>{{ file.original_filename|truncatechars:40 }}</td>
                    <td>{{ key }}</td>
                    <td>{{ file.date_modified|date:"Y-m-d G:i" }}</td>
                    <td>{% if can_view_file_flag %}
                        <a href="{% url 'article_file_download' 'id' article.pk file.pk %}"><i
                                class="fa fa-download">&nbsp;</i></a>{% endif %}
                    </td>
                    <td><a href="{% url 'article_file_make_galley' article.pk file.pk %}?return={{ request.path|urlencode }}"><i
                            class="fa fa-share-square-o">&nbsp;</i></a>{% hook 'conversion_buttons' %}</td>
                </tr>
                {% endfor %}
            {% endfor %}
        </table>
        <a href="#" class="button" data-open="prodfile">Upload File</a>
        </div>
    </div>
    <button class="close-button" data-close aria-label="Close reveal" type="button">
        <span aria-hidden="true">&times;</span>
    </button>
</div>